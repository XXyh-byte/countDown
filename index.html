<!DOCTYPE html>
<html lang="en" data-color-mode="auto" data-dark-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Countdown</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" href="assets/htmlIcon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="assets/htmlIcon.ico">
  <style>
    :root {
      /* GitHub 标准色 */
      --gh-light-bg: #f6f8fa;
      --gh-light-card: #ffffff;
      --gh-light-border: #d0d7de;
      --gh-light-text: #24292f;
      --gh-light-text-secondary: #57606a;
      --gh-light-primary: #2da44e;
      /* 绿色主按钮 */
      --gh-light-primary-hover: #2c974b;
      --gh-light-success: #1a7f37;
      --gh-light-warning: #9a6700;
      --gh-light-danger: #cf222e;

      --gh-dark-bg: #0d1117;
      --gh-dark-card: #161b22;
      --gh-dark-border: #30363d;
      --gh-dark-text: #e6edf3;
      --gh-dark-text-secondary: #7d8590;
      --gh-dark-primary: #3fb950;
      /* 绿色主按钮 */
      --gh-dark-primary-hover: #38a44a;
      --gh-dark-success: #238636;
      --gh-dark-warning: #bb8009;
      --gh-dark-danger: #da3633;
    }

    /* 主题切换逻辑保持不变 */
    body[data-color-mode="auto"] {
      --gh-bg: var(--gh-light-bg);
      --gh-card: var(--gh-light-card);
      --gh-border: var(--gh-light-border);
      --gh-text: var(--gh-light-text);
      --gh-text-secondary: var(--gh-light-text-secondary);
      --gh-primary: var(--gh-light-primary);
      --gh-primary-hover: var(--gh-light-primary-hover);
      --gh-success: var(--gh-light-success);
      --gh-warning: var(--gh-light-warning);
      --gh-danger: var(--gh-light-danger);
    }

    body[data-color-mode="auto"][data-dark-theme="dark"] {
      @media (prefers-color-scheme: dark) {
        --gh-bg: var(--gh-dark-bg);
        --gh-card: var(--gh-dark-card);
        --gh-border: var(--gh-dark-border);
        --gh-text: var(--gh-dark-text);
        --gh-text-secondary: var(--gh-dark-text-secondary);
        --gh-primary: var(--gh-dark-primary);
        --gh-primary-hover: var(--gh-dark-primary-hover);
        --gh-success: var(--gh-dark-success);
        --gh-warning: var(--gh-dark-warning);
        --gh-danger: var(--gh-dark-danger);
      }
    }

    body[data-color-mode="dark"] {
      --gh-bg: var(--gh-dark-bg);
      --gh-card: var(--gh-dark-card);
      --gh-border: var(--gh-dark-border);
      --gh-text: var(--gh-dark-text);
      --gh-text-secondary: var(--gh-dark-text-secondary);
      --gh-primary: var(--gh-dark-primary);
      --gh-primary-hover: var(--gh-dark-primary-hover);
      --gh-success: var(--gh-dark-success);
      --gh-warning: var(--gh-dark-warning);
      --gh-danger: var(--gh-dark-danger);
    }

    /* 基础样式 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition:
        background-color 0.2s ease,
        border-color 0.2s ease,
        transform 0.1s ease;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background-color: var(--gh-bg);
      color: var(--gh-text);
      line-height: 1.5;
      padding: 16px;
      min-height: 100vh;
    }

    /* 增强的卡片设计 */
    .container {
      max-width: 780px;
      margin: 24px auto;
      background-color: var(--gh-card);
      border: 1px solid var(--gh-border);
      border-radius: 12px !important;
      /* 更大的圆角 */
      padding: 32px;
      box-shadow:
        0 1px 3px rgba(0, 0, 0, 0.04),
        0 8px 24px rgba(0, 0, 0, 0.06);
      position: relative;
      overflow: hidden;
    }

    /* 顶部装饰条 */
    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #54aeff, #0969da, #8250df, #d1247f);
    }

    /* 头部区域 */
    .header {
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      user-select: none;
    }

    h1 {
      font-size: 24px;
      font-weight: 700;
      /* 更粗的字体 */
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--gh-text);
    }

    .title-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(84, 174, 255, 0.1);
      border-radius: 50%;
      color: #0969da;
    }

    .subtitle {
      color: var(--gh-text-secondary);
      font-size: 14px;
      max-width: 80%;
      line-height: 1.5;
    }

    /* 状态标签 */
    .status-badge {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 2em;
      background-color: var(--gh-bg);
      border: 1px solid var(--gh-border);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-badge.working {
      background-color: rgba(46, 160, 67, 0.1);
      border-color: rgba(46, 160, 67, 0.4);
      color: var(--gh-success);
    }

    .status-badge.weekend {
      background-color: rgba(187, 128, 9, 0.1);
      border-color: rgba(187, 128, 9, 0.4);
      color: var(--gh-warning);
    }

    .status-badge.ended {
      background-color: rgba(218, 54, 51, 0.1);
      border-color: rgba(218, 54, 51, 0.4);
      color: var(--gh-danger);
    }

    /* 倒计时显示 */
    .countdown-container {
      margin: 28px 0;
      padding: 24px;
      background-color: var(--gh-bg);
      border: 1px solid var(--gh-border);
      border-radius: 8px;
      text-align: center;
      position: relative;
      user-select: none;
    }

    .countdown-label {
      position: absolute;
      top: -10px;
      left: 16px;
      font-size: 12px;
      font-weight: 600;
      background-color: var(--gh-card);
      padding: 0 8px;
      color: var(--gh-text-secondary);
    }

    #countdown {
      font-size: 42px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      color: var(--gh-text);
      letter-spacing: 1px;
      margin: 8px 0;
    }

    .countdown-subtext {
      font-size: 14px;
      color: var(--gh-text-secondary);
      margin-top: 8px;
    }

    /* 按钮组 */
    .btn-group {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      font-size: 0.875rem;
      font-weight: 300;
      background-color: var(--gh-primary);
      color: white;
      border: 1px solid rgba(27, 31, 36, 0.15);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow:
        0 1px 0 rgba(27, 31, 36, 0.04),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }

    button:hover {
      background-color: var(--gh-primary-hover);
      transform: translateY(-1px);
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }

    button:active {
      transform: translateY(0);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    button.secondary {
      background-color: var(--gh-card);
      color: var(--gh-text);
      border-color: var(--gh-border);
    }

    button.secondary:hover {
      background-color: var(--gh-bg);
      border-color: var(--gh-text-secondary);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* 日志区域 */
    .log-container {
      margin-top: 32px;
      border-top: 1px solid var(--gh-border);
      padding-top: 24px;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .log-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--gh-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .log-actions {
      display: flex;
      gap: 8px;
    }

    #log {
      font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, monospace;
      font-size: 13px;
      background-color: var(--gh-bg);
      border: 1px solid var(--gh-border);
      border-radius: 6px;
      padding: 16px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      line-height: 1.6;
    }

    #log.visible {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    .countdown-notice {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #1a1a1a;
      color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      z-index: 1000;
      width: 250px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border-left: 4px solid #ff6b6b;
    }

    .countdown-header {
      font-weight: 600;
      margin-bottom: 8px;
      color: #ff6b6b;
      font-size: 15px;
    }

    .countdown-timer {
      font-size: 14px;
      margin: 5px 0;
      transition: all 0.3s ease;
    }

    .countdown-warning {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 8px;
      color: #adb5bd;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(5px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .container {
        padding: 24px 16px;
        border-radius: 0 !important;
      }

      .header {
        flex-direction: column;
        gap: 16px;
      }

      .btn-group {
        flex-direction: column-reverse;
      }

      #countdown {
        font-size: 32px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="title-group">
        <h1>
          <span class="title-icon">
            <i class="fas fa-clock"></i>
          </span>
          Workday Countdown
        </h1>
        <p class="subtitle">Track your remaining work hours</p>
        <span id="statusBadge" class="status-badge">
          <i class="fas fa-circle-notch fa-spin"></i>
          Loading...
        </span>
      </div>
      <button id="themeToggle" class="secondary">
        <i class="fas fa-moon"></i>
        <span>Dark Mode</span>
      </button>
    </div>

    <div class="countdown-container">
      <span class="countdown-label">REMAINING TIME</span>
      <div id="countdown">--:--:--</div>
      <div id="countdownSubtext" class="countdown-subtext">
        Until end of workday at 18:00
      </div>
    </div>

    <div class="btn-group">
      <button id="clearLogBtn" class="secondary" disabled>
        <i class="fas fa-trash"></i>
        <span>Sudo rm -rf</span>
      </button>
      <button id="toggleBtn" disabled>
        <i class="fas fa-play"></i>
        <span>Start Logging</span>
      </button>
    </div>

    <div class="log-container">
      <div class="log-header">
        <div class="log-title">Activity Log</div>
        <div class="log-actions">
          <span id="logStatus" class="status-badge">
            <i class="fas fa-pause"></i>
            Inactive
          </span>
        </div>
      </div>
      <pre id="log"></pre>
    </div>
  </div>

  <script>
    // DOM 元素
    const countdownEl = document.getElementById('countdown');
    const countdownSubtext = document.getElementById('countdownSubtext');
    const statusBadge = document.getElementById('statusBadge');
    const logArea = document.getElementById('log');
    const logStatus = document.getElementById('logStatus');
    const toggleBtn = document.getElementById('toggleBtn');
    const clearLogBtn = document.getElementById('clearLogBtn');
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // 状态变量
    let intervalIdLog = null;
    let countdownInterval = null;
    let hasLoggedEnd = false;
    let lastCheckedDate = new Date().getDate();

    // 主题切换
    function updateThemeIcon() {
      const isDark = body.getAttribute('data-color-mode') === 'dark';
      themeToggle.innerHTML = isDark
        ? '<i class="fas fa-sun"></i><span>Light Mode</span>'
        : '<i class="fas fa-moon"></i><span>Dark Mode</span>';
    }

    themeToggle.addEventListener('click', () => {
      const currentMode = body.getAttribute('data-color-mode');
      const newMode = currentMode === 'auto' ? 'dark' :
        currentMode === 'dark' ? 'auto' : 'dark';

      body.setAttribute('data-color-mode', newMode);
      localStorage.setItem('themePreference', newMode);
      updateThemeIcon();
    });

    // 初始化主题
    if (localStorage.getItem('themePreference')) {
      body.setAttribute('data-color-mode', localStorage.getItem('themePreference'));
    }
    updateThemeIcon();

    // 格式化时间
    function getFormattedTime() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }

    // 日志功能
    function logMessage(type, message) {
      const timeStr = getFormattedTime();
      const entry = `[${timeStr}] ${type.toUpperCase()} >> ${message}\n`;
      logArea.textContent += entry;
      logArea.scrollTop = logArea.scrollHeight;
    }

    // 检查日期变化
    function checkDateChange() {
      const currentDate = new Date().getDate();
      if (currentDate !== lastCheckedDate) {
        lastCheckedDate = currentDate;
        hasLoggedEnd = false;
        logMessage("root", "New day detected, resetting counters");
      }
    }

    // 工作时间检测
    function checkWorkTime() {
      const now = new Date();
      checkDateChange();

      const isWeekend = now.getDay() === 0 || now.getDay() === 6;
      const workdayEnd = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate(),
        18, 0, 0
      );

      return {
        isWeekend,
        isWorking: !isWeekend && now <= workdayEnd,
        workdayEnd
      };
    }

    // 更新状态标签
    function updateStatusBadge() {
      const { isWeekend, isWorking } = checkWorkTime();

      statusBadge.innerHTML = isWeekend
        ? '<i class="fas fa-umbrella-beach"></i> Weekend'
        : isWorking
          ? '<i class="fas fa-briefcase"></i> Working'
          : '<i class="fas fa-mug-hot"></i> Ended';

      statusBadge.className = isWeekend
        ? 'status-badge weekend'
        : isWorking
          ? 'status-badge working'
          : 'status-badge ended';
    }

    // 更新倒计时
    function updateCountdown() {
      const { isWeekend, isWorking, workdayEnd } = checkWorkTime();
      updateStatusBadge();

      if (isWeekend) {
        countdownEl.textContent = "00:00:00";
        countdownSubtext.textContent = "Enjoy your weekend!";
        return;
      }

      if (!isWorking) {
        countdownEl.textContent = "00:00:00";
        countdownSubtext.textContent = "Workday has ended";

        if (!hasLoggedEnd) {
          logMessage("root", "Workday completed - Time to relax!");
          hasLoggedEnd = true;
        }
        return;
      }

      const diffMs = workdayEnd - new Date();
      const hours = Math.floor(diffMs / 3600000).toString().padStart(2, '0');
      const minutes = Math.floor((diffMs % 3600000) / 60000).toString().padStart(2, '0');
      const seconds = Math.floor((diffMs % 60000) / 1000).toString().padStart(2, '0');


      countdownEl.textContent = `${hours}:${minutes}:${seconds}`;
      countdownSubtext.textContent = `Remaining until ${workdayEnd.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
    }

    // 按钮控制
    function updateButtons() {
      const { isWorking } = checkWorkTime();

      toggleBtn.disabled = !isWorking;
      toggleBtn.innerHTML = intervalIdLog
        ? '<i class="fas fa-stop"></i><span>Stop Logging</span>'
        : '<i class="fas fa-play"></i><span>Start Logging</span>';

      clearLogBtn.disabled = !logArea.textContent.trim();

      logStatus.innerHTML = intervalIdLog
        ? '<i class="fas fa-play"></i> Active'
        : '<i class="fas fa-pause"></i> Inactive';
      logStatus.className = intervalIdLog
        ? 'status-badge working'
        : 'status-badge';
    }

    // 初始化
    function init() {
      updateCountdown();
      countdownInterval = setInterval(updateCountdown, 1000);
      updateButtons();

      // 日志控制
      toggleBtn.addEventListener('click', () => {
        if (intervalIdLog) {
          clearInterval(intervalIdLog);
          intervalIdLog = null;
          logMessage("root", "Logging stopped");
        } else {
          logArea.classList.add('visible');
          logMessage("root", "Logging started (5 minute interval)");

          intervalIdLog = setInterval(() => {
            logMessage("ETA for clocking off", countdownEl.textContent);
          }, 5 * 60 * 1000);
        }
        updateButtons();
      });

      // 清空日志
      clearLogBtn.addEventListener('click', function () {
        // 2. Clear logs with system notification
        logArea.textContent = '';
        logMessage("SYSTEM", "All logs cleared - Application shutting down...");

        // 3. Create professional countdown display
        const countdownEl = document.createElement('div');
        countdownEl.className = 'countdown-notice';
        countdownEl.innerHTML = `
      <div class="countdown-header">SHUTDOWN INITIATED</div>
      <div class="countdown-timer"></div>
      <div class="countdown-warning">Please save any ongoing work</div>
    `;
        document.body.appendChild(countdownEl);

        // 4. Start enhanced countdown
        let remainingSeconds = 5;
        updateCountdownDisplay();

        const shutdownTimer = setInterval(() => {
          remainingSeconds--;
          updateCountdownDisplay();

          if (remainingSeconds <= 0) {
            clearInterval(shutdownTimer);
            initiateShutdown();
          }
        }, 1000);

        function updateCountdownDisplay() {
          const timerEl = countdownEl.querySelector('.countdown-timer');
          timerEl.textContent = `Closing in ${remainingSeconds} second${remainingSeconds !== 1 ? 's' : ''}...`;

          // Visual urgency increases as time runs out
          if (remainingSeconds <= 3) {
            timerEl.style.color = '#ff6b6b';
            timerEl.style.fontWeight = 'bold';
          }
        }

        function initiateShutdown() {
          countdownEl.querySelector('.countdown-timer').textContent = 'Closing now...';
          setTimeout(() => {
            countdownEl.remove();
            try {
              window.close();
            } catch {
              window.location.href = 'about:blank';
            }
          }, 500);
        }
      });


    }

    init();
  </script>
</body>

</html>
